##  프로세스와 스레드

### 멀티태스킹
- CPU 코어가 프로그램 A 코드를 수행하다가 프로그램 B를 수행을 반복 동작
- CPU가 매우 빠르게 두 프로그램의 코드를 번갈아 수행한다면, 사람이 느낄 때 두 프로그램이 동시에 실행되는 것
  처럼 느껴짐. (대략 0.01초(10ms) 단위로 돌아가며 실행한다.) cpu는 초당 수십억 번 이상의 연산을 수행한다.
- 컴퓨터 시스템이 동시에 여러 작업을 수행하는 능력을 멀티태스킹이라 한다.
- cpu에 어떤 프로그램을 얼마만큼 실행할지는 운영체제가 결정(스케줄링)


### 멀티프로세싱
- CPU 코어가 2개 이상 (cpu 코어가 2개이면 물리적으로 동시에 2개의 프로그램 처리 가능)
- 프로세서(CPU 코어) 2개 이상을 사용하여 여러 작업을 동시에 처리하는 기술


### 프로세스
- 운영체제 안에서 실행중인 프로그램을 프로세스라 한다.
- 프로세스는 실행 중인 프로그램의 인스턴스이다.
- 각 프로세스는 독립적인 메모리 공간을 갖고 있다.

프로세스의 메모리 구성
- 코드 섹션 : 실행할 프로그램의 코드 저장되는 부분
- 데이터 섹션 : 전역 변수 및 정적 변수가 저장되는 부분
- 힙 : 동적으로 할당되는 메모리 영역
- 스택 : 메서드 함수 호출 시 생성되는 지역 변수와 반환 주소가 저장되는 영역(스레드에 포함)

### 스레드
- 프로세스는 하나 이상의 스레드를 반드시 포함한다.
- 스레드는 프로세스 내에서 실행되는 작업의 단위

메모리 구성
- 공유 메모리 : 같은 프로세스의 코드 섹션, 데이터 섹션, 힙(메모리)은 프로세스 안의 모든 스레드가 공유한다
- 개별 스택 : 각 스레드는 자신의 스택을 갖고 있다.

멀티스레드가 필요한 이유
- 하나의 프로그램도 그 안에서 동시에 여러 작업이 필요 


### 컨텍스트 스위칭
- 스레드 A -> 스레드 B를 실행할 때 스레드 A를 멈추는 시점에 CPU에서 사용하던 값들을 메모리에 저장해두어야 한다. 그리고 스레드 A를 다시 실행할 때 이 값들을
  CPU에 다시 불러와야 한다.
- 멀티스레드는 대부분 효율적이지만, 컨텍스트 스위칭 과정이 필요하므로 항상 효율적인 것은 아니다.


----------------------------------------------
#### CPU 바운드 작업 vs I/O 바운드 작업
각각의 스레드가 하는 작업은 크게 2가지로 구분할 수 있다.
- CPU-바운드 작업 (CPU-bound tasks)
  - CPU의 연산 능력을 많이 요구하는 작업을 의미한다.
  - 이러한 작업은 주로 계산, 데이터 처리, 알고리즘 실행 등 CPU의 처리 속도가 작업 완료 시간을 결정하는 경우다.
  - 예시: 복잡한 수학 연산, 데이터 분석, 비디오 인코딩, 과학적 시뮬레이션 등
- I/O-바운드 작업 (I/O-bound tasks)
  - 디스크, 네트워크, 파일 시스템 등과 같은 입출력(I/O) 작업을 많이 요구하는 작업을 의미한다.
  - 이러한 작업은 I/O 작업이 완료될 때까지 대기 시간이 많이 발생하며, CPU는 상대적으로 유휴(대기) 상태에 있는 경우가 많다. 쉽게 이야기해서 스레드가 CPU를 사용하지 않고 I/O 작업이 완료될 때 까지 대기한다.
  - 예시: 데이터베이스 쿼리 처리, 파일 읽기/쓰기, 네트워크 통신, 사용자 입력 처리 등.


- 웹 애플리케이션 서버에서는 CPU 바운드 작업보다 I/O-바운드 작업이 많다.
- 일반적으로 자바 웹 애플리케이션 서버의 경우 사용자의 요청 하나를 처리하는데 1개의 스레드 필요. 
- 4명이 동시에 요청하면 4개의 스레드 작동

#### 예시 
- I/O-바운드 작업: 사용자 입력 대기, DB 조회 등으로 CPU 사용이 낮음(가정 1%). 
- 스레드 수를 CPU 코어 수(예: 4개)에 맞추면 성능 저하와 자원 낭비가 발생.
- CPU 활용률이 낮을 때는 더 많은 스레드를 생성(사용량이 1%라면, 스레드 100개 만들 수 있음)해 동시 처리량을 늘리는 것이 중요.
- 최적의 스레드 수는 성능 테스트로 결정해야 하며, 장비 업그레이드보다 설정 조정이 우선.

----------------------------------------------

- CPU-바운드 작업 : CPU 코어 수 + 1개
  - CPU를 거의 100% 사용하는 작업이므로 스레드를 CPU 숫자에 최적화
- I/O-바운드 작업: CPU 코어 수 보다 많은 스레드를 생성, CPU를 최대한 사용할 수 있는 숫자까지 스레드 생성
  - CPU를 많이 사용하지 않으므로 성능 테스트를 통해 CPU를 최대한 활용하는 숫자까지 스레드 생성
  - 단 너무 많은 스레드를 생성하면 컨텍스트 스위칭 비용도 함께 증가 - 적절한 성능 테스트 필요

  
EX. 쓰레드 설정 방법
```JAVA
server:
  tomcat:
    threads:
      max: 500 
```



