# Section 2. 프로세스와 스레드 소개

## 멀티태스킹

멀티태스킹은 단일 CPU가 여러 작업을 동시에 수행하는 것처럼 보이게 하는것을 말한다.

프로그램 A, B를 번갈아 가면서 실행해도 CPU는 처리속도가 엄청 빠르기 때문에 사람은 두개의 프로그램이 동시에 실행된다고 생각하게 된다.

<img width="769" alt="image" src="https://github.com/user-attachments/assets/f8f390be-ecc3-47a4-81b3-3ec4184d7bb8" />

## 멀티프로세싱

CPU 코어가 둘 이상이라면?

물리적으로 동시에 2개의 프로그램을 처리할 수 있게된다.

컴퓨터 시스템에서 둘 이상의 프로세서(CPU코어)를 이용하여 여러 작업을 동시에 처리하는 기술을 말한다.

멀티프로세싱은 하드웨어 장비의 관점이고, 멀티태스킹은 운영체제 소프트웨어의 관점이다.

## 프로세스

프로세스는 실행중인 프로그램의 인스턴스이다.

운영체제에서 별도의 작업 단위로 분리해서 관리된다. 프로세스끼리 간섭 x

## 스레드

프로세스는 하나이상의 스레드를 반드시 포함한다.

스레드는 프로세스 내에서 실행되는 작업의 단위이다.

메모리 구성

- 공유메모리 : 같은 프로세스의 코드섹션, 데이터 섹션, 힙 3가지는 모두 공유한다.
- 개별 스택 : 각 스레드는 개별 스택을 가지고 있다.

## 컨텍스트 스위칭

멀티태스킹이 반드시 효율적인 것 만은 아니다.

스레드A를 멈추는 시점에 CPU에서 사용하던 이런 값들을 메모리에 저장해두어야 한다. 그리고 이후에 스레드A를 다시 실행할 때 이 값들을 CPU에 다시 불러와야 한다.

이런 과정을 컨텍스트 스위칭이라 한다.

결과적으로 컨텍스트 스위칭 과정에는 약간의 비용이 발생한다.

### **CPU - 4개, 스레드 2개**

스레드의 숫자가 너무 적으면 모든 CPU를 100% 다 활용할 수 없지만, 스레드가 몇 개 없으므로 컨텍스트 비용이 줄어든다.

### **CPU - 4개, 스레드 100개**

스레드의 숫자가 너무 많으면 CPU를 100% 다 활용할 수 있지만 컨텍스트 비용이 늘어난다.

### **CPU - 4개, 스레드 4개**

스레드의 숫자를 CPU의 숫자에 맞춘다면 CPU를 100% 활용할 수 있고, 컨텍스트 스위칭 비용도 자주 발생하지 않기 때문에 최적의 상태가 된다.

이상적으로는 CPU 코어 수 + 1개 정도로 스레드를 맞추면 특정 스레드가 잠시 대기할 때 남은 스레드를 활용할 수 있다.

## **CPU 바운드 작업 vs I/O 바운드 작업**

각각의 스레드가 하는 작업은 크게 2가지로 구분할 수 있다.

### CPU-바운드 작업

- CPU의 연산 능력을 많이 요구하는 작업을 의미한다
- 주로 계산, 데이터처리, 알고리즘 실행 등 CPU의 철 속도가 작업 완료 시간을 결정하는 경우

### I/O-바운드 작업

- 디스크, 네트워크, 파일 시스템등과 같은 입출력(I/O) 작업을 많이 요구하는 작업을 의미한다
- 이러한 작업은 I/O 작업이 완료될 때까지 대기 시간이 많이 발생하며, CPU는 상대적으로 유휴(대기) 상태에 있는 경우가 많다.
- 예시 : 데이터베이스 쿼리 처리, 파일 읽기/쓰기, 네트워크 통신, 사용자 입력 처리 등

스레드의 숫자는 CPU-바운드 작업이 많은가, 아니면 I/O 바운드 작업이 많은가에 따라 다르게 설정되어야 한다

웹 애플리케이션 서버같은 경우는 보통 I/O바운드 작업이 많다

- CPU-바운드 작업 : CPU 코어 수 + 1개
    - CPU를 거의 100% 사용하는 작업이므로 스레드를 CPU 숫자에 최적화
- I/O-바운드 작업 : CPU 코어 수 보다 많은 스레드를 생성, CPU를 최대한 사용할 수 있는 숫자까지 스레드 생성
    - CPU를 많이 사용하지 않으므로 성능 테스트를 통해 CPU를 최대한 활용하는 숫자까지 스레드 생성
    - 단 너무 많은 스레드를 생성하면 컨텍스트 스위칭 비용도 함께 증가 (적절한 성능 테스트 필요)
